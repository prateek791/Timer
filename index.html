<!DOCTYPE html>
<html lang="en">
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deep Focus</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f1220;
  color: #eaeaff;
  text-align: center;
}
.container { padding: 20px; }
input, button {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}
input { background: #1c2045; color: #fff; }
button { background: #5a63ff; color: #fff; font-weight: bold; }
button.secondary { background: #2a2f66; }
.hidden { display: none; }
.timer { font-size: 60px; margin: 30px 0; }
.small { font-size: 14px; opacity: 0.8; }
.todayBox {
  background:#161a35;
  padding:12px;
  border-radius:6px;
  margin-bottom:15px;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- SETUP -->
<div class="container" id="setup">
  <h2>üéØ Deep Focus</h2>

  <div class="todayBox" id="todayTime">üìÖ Today: 0 min</div>

  <div class="small">
    Daily Goal: <b>10 hours</b><br>
    Session Limit: <b>150 minutes</b><br>
    Starting Block: <b>25 minutes</b><br>
    Reminder: <b>12:00 AM</b>
  </div>

  <input id="task" placeholder="What exactly will you study?" />

  <button onclick="startSession()">START SESSION</button>
</div>

<!-- FOCUS -->
<div class="container hidden" id="focus">
  <div class="small" id="currentTask"></div>
  <div class="timer" id="time">00:00</div>
  <button onclick="focused()">‚úÖ Still Focused</button>
  <button class="secondary" onclick="drifted()">‚ö†Ô∏è Mind Drifted</button>
</div>

<!-- SUMMARY -->
<div class="container hidden" id="summary">
  <h2>üìä Summary</h2>
  <p id="summaryText"></p>
  <p id="streakText"></p>
  <p id="historyText"></p>
  <button onclick="location.reload()">New Session</button>
</div>

<script>
/* ===== FIXED CONSTANTS ===== */
const DAILY_GOAL = 600;     // 10 hours
const START_BLOCK = 25;    // minutes
const MAX_SESSION = 150;   // minutes
const REMINDER_HOUR = 0;   // 12:00 AM
const REMINDER_MIN = 0;

let task="", blockMinutes=START_BLOCK;
let totalFocused=0, driftCount=0, timer, secondsLeft;

function todayKey() {
  return new Date().toISOString().slice(0,10);
}

function minutesToHM(mins){
  let h=Math.floor(mins/60), m=mins%60;
  return h>0 ? `${h}h ${m}m` : `${m} min`;
}

/* ---------- REMINDER ---------- */
function checkReminder() {
  let history = JSON.parse(localStorage.getItem("focusHistory") || "{}");
  let today = todayKey();

  let now = new Date();
  let r = new Date();
  r.setHours(REMINDER_HOUR, REMINDER_MIN, 0, 0);

  if (now >= r && !history[today]) {
    alert("‚è∞ Reminder: You haven't started your focus session today.");
  }
}

/* ---------- TODAY ---------- */
function updateToday(){
  let h = JSON.parse(localStorage.getItem("focusHistory")||"{}");
  document.getElementById("todayTime").innerText =
    `üìÖ Today: ${minutesToHM(h[todayKey()]||0)}`;
}

function startSession() {
  task = document.getElementById("task").value.trim();
  if (!task) return alert("Enter ONE clear task.");

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("focus").classList.remove("hidden");
  document.getElementById("currentTask").innerText = "Task: " + task;

  startBlock();
}

/* ---------- TIMER ---------- */
function startBlock() {
  secondsLeft = blockMinutes * 60;
  timer = setInterval(tick, 1000);
  updateTime();
}

function tick() {
  secondsLeft--; totalFocused++;
  if (secondsLeft <= 0) { clearInterval(timer); nextBlock(); }
  updateTime();
}

function updateTime() {
  let m = Math.floor(secondsLeft / 60);
  let s = secondsLeft % 60;
  document.getElementById("time").innerText =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

function focused() {}

function drifted() {
  driftCount++;
  clearInterval(timer);
  setTimeout(startBlock, 30000);
}

function nextBlock() {
  if (totalFocused/60 >= MAX_SESSION) return endSession();
  if (blockMinutes < 60) blockMinutes += 10;
  startBlock();
}

/* ---------- END ---------- */
function endSession() {
  document.getElementById("focus").classList.add("hidden");
  document.getElementById("summary").classList.remove("hidden");

  let mins = Math.floor(totalFocused/60);
  let h = JSON.parse(localStorage.getItem("focusHistory")||"{}");
  let k = todayKey();
  h[k] = (h[k]||0) + mins;
  localStorage.setItem("focusHistory", JSON.stringify(h));

  document.getElementById("summaryText").innerHTML =
    `Session: <b>${mins} min</b><br>
     Today Total: <b>${minutesToHM(h[k])}</b><br>
     Goal: <b>10 hours</b> ‚Üí ${h[k]>=DAILY_GOAL?"‚úÖ":"‚ùå"}`;

  updateToday();
}

/* ---------- INIT ---------- */
updateToday();
checkReminder();
</script>

</body>
</html>

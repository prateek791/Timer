<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deep Focus</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f1220;
  color: #eaeaff;
  text-align: center;
}
.container { padding: 20px; }
input, select, button {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}
input, select { background: #1c2045; color: #fff; }
button { background: #5a63ff; color: #fff; font-weight: bold; }
button.secondary { background: #2a2f66; }
.hidden { display: none; }
.timer { font-size: 60px; margin: 30px 0; }
.small { font-size: 14px; opacity: 0.8; }
hr { border: none; border-top: 1px solid #333; margin: 20px 0; }
.todayBox {
  background:#161a35;
  padding:12px;
  border-radius:6px;
  margin-bottom:15px;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- SETUP -->
<div class="container" id="setup">
  <h2>üéØ Deep Focus Session</h2>

  <div class="todayBox" id="todayTime">üìÖ Today: 0 min</div>

  <input id="task" placeholder="What exactly will you study?" />

  <label>Starting focus block</label>
  <select id="startBlock">
    <option value="25">25 minutes</option>
    <option value="35">35 minutes</option>
    <option value="45">45 minutes</option>
  </select>

  <label>Daily focus goal</label>
  <select id="dailyGoal">
    <option value="60">1 hour</option>
    <option value="120">2 hours</option>
    <option value="180">3 hours</option>
    <option value="300">5 hours</option>
    <option value="600">10 hours</option>
  </select>

  <label>Daily reminder time</label>
  <input type="time" id="reminderTime" value="18:00">

  <label>Maximum session length</label>
  <select id="maxSession">
    <option value="90">90 minutes</option>
    <option value="120">120 minutes</option>
    <option value="180">180 minutes</option>
  </select>

  <button onclick="startSession()">START DEEP FOCUS</button>
</div>

<!-- FOCUS -->
<div class="container hidden" id="focus">
  <div class="small" id="currentTask"></div>
  <div class="timer" id="time">00:00</div>
  <button onclick="focused()">‚úÖ Still Focused</button>
  <button class="secondary" onclick="drifted()">‚ö†Ô∏è Mind Drifted</button>
</div>

<!-- SUMMARY -->
<div class="container hidden" id="summary">
  <h2>üìä Session Summary</h2>
  <p id="summaryText"></p>
  <hr>
  <p id="todaySummary"></p>
  <hr>
  <p id="streakText"></p>
  <hr>
  <p id="historyText"></p>
  <button onclick="location.reload()">New Session</button>
</div>

<script>
let task="", blockMinutes=25, maxSession=90, dailyGoal=120;
let totalFocused=0, driftCount=0, timer, secondsLeft;

function todayKey() {
  return new Date().toISOString().slice(0,10);
}

function minutesToHM(mins){
  let h=Math.floor(mins/60), m=mins%60;
  return h>0 ? `${h}h ${m}m` : `${m} min`;
}

/* ---------- REMINDER ---------- */
function checkReminder() {
  let reminder = localStorage.getItem("reminderTime");
  let history = JSON.parse(localStorage.getItem("focusHistory") || "{}");
  let today = todayKey();
  if (!reminder) return;

  let now = new Date();
  let [h, m] = reminder.split(":");
  let r = new Date();
  r.setHours(h, m, 0, 0);

  if (now >= r && !history[today]) {
    alert("‚è∞ Reminder: You haven't started your focus session today.");
  }
}

/* ---------- TODAY DISPLAY ---------- */
function updateTodayDisplay(){
  let history = JSON.parse(localStorage.getItem("focusHistory")||"{}");
  let mins = history[todayKey()] || 0;
  document.getElementById("todayTime").innerText =
    `üìÖ Today: ${minutesToHM(mins)} studied`;
}

/* ---------- START ---------- */
function startSession() {
  task = document.getElementById("task").value.trim();
  if (!task) { alert("Enter ONE clear task."); return; }

  blockMinutes = +document.getElementById("startBlock").value;
  maxSession = +document.getElementById("maxSession").value;
  dailyGoal = +document.getElementById("dailyGoal").value;

  localStorage.setItem(
    "reminderTime",
    document.getElementById("reminderTime").value
  );

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("focus").classList.remove("hidden");
  document.getElementById("currentTask").innerText = "Current task: " + task;

  startBlock();
}

/* ---------- TIMER ---------- */
function startBlock() {
  secondsLeft = blockMinutes * 60;
  updateTime();
  timer = setInterval(tick, 1000);
}

function tick() {
  secondsLeft--;
  totalFocused++;
  if (secondsLeft <= 0) { clearInterval(timer); nextBlock(); }
  updateTime();
}

function updateTime() {
  let m = Math.floor(secondsLeft / 60);
  let s = secondsLeft % 60;
  document.getElementById("time").innerText =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

function focused() {}

function drifted() {
  driftCount++;
  clearInterval(timer);
  setTimeout(startBlock, 30000);
}

function nextBlock() {
  if (totalFocused/60 >= maxSession) { endSession(); return; }
  if (blockMinutes < 60) blockMinutes += 10;
  startBlock();
}

/* ---------- END ---------- */
function endSession() {
  document.getElementById("focus").classList.add("hidden");
  document.getElementById("summary").classList.remove("hidden");

  let mins = Math.floor(totalFocused/60);
  saveHistory(mins);
  updateStreak();

  let todayTotal = JSON.parse(localStorage.getItem("focusHistory"))[todayKey()];

  document.getElementById("summaryText").innerHTML =
    `Focused This Session: <b>${mins} min</b><br>
     Mind Drifts: <b>${driftCount}</b><br>
     Daily Goal: <b>${minutesToHM(dailyGoal)}</b> ‚Üí ${todayTotal>=dailyGoal?"‚úÖ Achieved":"‚ùå Not met"}`;

  document.getElementById("todaySummary").innerHTML =
    `üìÖ Today Total: <b>${minutesToHM(todayTotal)}</b>`;
}

function saveHistory(mins) {
  let data = JSON.parse(localStorage.getItem("focusHistory")||"{}");
  let k = todayKey();
  data[k] = (data[k]||0) + mins;
  localStorage.setItem("focusHistory", JSON.stringify(data));

  let txt = Object.keys(data).slice(-5)
    .map(d=>`${d}: ${minutesToHM(data[d])}`).join("<br>");
  document.getElementById("historyText").innerHTML =
    "<b>Recent Days</b><br>"+txt;
}

function updateStreak() {
  let last = localStorage.getItem("lastFocusDate");
  let streak = +(localStorage.getItem("focusStreak")||0);
  let today = todayKey();

  if (last) {
    let diff = (new Date(today)-new Date(last))/(1000*60*60*24);
    if (diff===1) streak++;
    else if (diff>1) streak=1;
  } else streak=1;

  localStorage.setItem("lastFocusDate", today);
  localStorage.setItem("focusStreak", streak);

  document.getElementById("streakText").innerHTML =
    `üî• Current Streak: <b>${streak} day(s)</b>`;
}

/* ---------- INIT ---------- */
updateTodayDisplay();
checkReminder();
</script>

</body>
</html>
